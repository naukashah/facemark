<!DOCTYPE html>
<html>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<head>

    <style>
        #video {
            border: 1px solid black;
            box-shadow: 2px 2px 3px black;
            width: 320px;
            height: 240px;
        }

        #photo {
            border: 1px solid black;
            box-shadow: 2px 2px 3px black;
            width: 320px;
            height: 240px;
        }

        #canvas {
            display: none;
        }

        .camera {
            width: 340px;
            display: inline-block;
        }

        .output {
            width: 340px;
            display: inline-block;
            vertical-align: top;
        }

        #startbutton {
            display: block;
            position: relative;
            margin-left: auto;
            margin-right: auto;
            bottom: 32px;
            background-color: rgba(0, 150, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0px 0px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 14px;
            font-family: "Lucida Grande", "Arial", sans-serif;
            color: rgba(255, 255, 255, 1.0);
        }

        .contentarea {
            font-size: 16px;
            font-family: "Lucida Grande", "Arial", sans-serif;
            width: 760px;
        }

        .align{
            display: block;
              margin-left: auto;
              margin-right: auto;
        }

    [type=submit]{
    margin-left: 445px;
    margin-top: -64px;
    width: 100px;
    height: 40px;
    font-size:14px;
    font-weight:700;
}
    </style>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="{%url 'index' %}">FaceMark</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <a class="nav-item nav-link active">Camera<span class="sr-only">(current)</span></a>
            <a class="nav-item nav-link" href="{%url 'embeddings' %}">Embeddings</a>
            <a class="nav-item nav-link disabled" href="{%url 'train' %}">Train</a>
        </div>
    </div>
     <ul class="nav navbar-nav navbar-right">
                <li class="nav-item">
                    <a class="nav-link" href="{%url 'login' %}">Logout</a>
                </li>
            </ul>
</nav>

    <div id="student_name_form" class="align">
        <form id="form" method="post" class="row g-3 needs-validation" novalidate>
            {% csrf_token %}

            <!-- {{ form }} -->
             <div class="col-md-3">
                 <div class="form-outline">
                    <label for="student_name_val" class="form-label">Enter student name:</label>
                    <input type="text" name="student_name_val" id="student_name_val" class="form-control input" required>
                     <div class="valid-feedback">Valid.</div>
                     <div class="invalid-feedback">Please fill out this field.</div>
                     </div>
             </div>

            <div class="col-md-3">
                 <div class="form-outline">
                    <label for="student_id_val" class="form-label">Enter student ID:</label>
                    <input type="text" name="student_id_val" id="student_id_val" class="form-control input" required>
                     <div class="valid-feedback">Valid.</div>
                     <div class="invalid-feedback">Please fill out this field.</div>
                     </div>
            </div>

            <div class="col-md-3">
                 <div class="form-outline">
                    <label for="user_type" class="form-label">Select User Type:</label>
                    <select type="text" name="user_type" id="user_type" class="form-control input" required>
                        <option value="Student">Student</option>
                        <option value="Teacher">Teacher</option>
                     <div class="valid-feedback">Valid.</div>
                     <div class="invalid-feedback">Please fill out this field.</div>

                <strong>
                    <input type="hidden" id="url" name="url">
                </strong>
            </div>
            <div>
                <div>
                    <input type="submit" value="Submit" id="student_name" name="student_name" onclick="hideForm()" class="btn btn-outline-success submitButton">
                </div>

            </div>
        </form>
    </div>
    <div class="container pt-5">
        <!--    <input type="button" value="Add Picture" name="add_image" onclick="addPicture()">-->
        <div class="camera">
            <video id="video">Video stream not available.</video>
            <button id="startbutton">Take photo</button>
        </div>

        <canvas id="canvas">
        </canvas>
        <div class="output">
            <img id="photo" alt="The screen capture will appear in this box.">
        </div>

        <div id="capturing_div">
            <p>Captured Images for {{student_name}}</p>
        </div>
    </div>
</body>

 <script>
let inputName = document.getElementById("student_name_val");
let inputId = document.getElementById("student_id_val");
let button = document.getElementById("student_name");

button.disabled = true;
inputName.addEventListener("change", stateHandle);

function stateHandle() {
    if(inputName.value === "" && inputId.value === "") {
        button.disabled = true;
    } else {
        button.disabled = false;
    }
}
</script>
<script>
    
    window.onload = function viewAdjust() {

        hideForm();

    }

    function hideForm() {


        var student = JSON.parse("{{student_name|escapejs}}")

        var divForm = document.getElementById("student_name_form")

        var divName = document.getElementById("capturing_div")

        if (student != null) {
            divName.style.display = ''
            divForm.style.display = 'none'
        }
        else {
            divName.style.display = 'none'
            divForm.style.display = ''
        }
    }
</script>
<script type="module"
    src="C:\Users\paria\OneDrive\Documents\ITU\Spring-2022\SWE690-Capstone-Project\FR\FaceMark\fs.js"></script>
<script>
    (function() {
    // The width and height of the captured photo. We will set the
    // width to the value defined here, but the height will be
    // calculated based on the aspect ratio of the input stream.

    var width = 320; // We will scale the photo width to this
    var height = 0; // This will be computed based on the input stream

    // |streaming| indicates whether or not we're currently streaming
    // video from the camera. Obviously, we start at false.

    var streaming = false;

    // The various HTML elements we need to configure or control. These
    // will be set by the startup() function.

    var video = null;
    var canvas = null;
    var photo = null;
    var startbutton = null;

    function showViewLiveResultButton() {
        if (window.self !== window.top) {
            // Ensure that if our document is in a frame, we get the user
            // to first open it in its own tab or window. Otherwise, it
            // won't be able to request permission for camera access.
            document.querySelector(".contentarea").remove();
            const button = document.createElement("button");
            button.textContent = "View live result of the example code above";
            document.body.append(button);
            button.addEventListener('click', () => window.open(location.href));
            return true;
        }
        return false;
    }

    function startup() {
        if (showViewLiveResultButton()) {
            return;
        }
        video = document.getElementById('video');
        canvas = document.getElementById('canvas');
        photo = document.getElementById('photo');
        startbutton = document.getElementById('startbutton');

        navigator.mediaDevices.getUserMedia({
                video: true,
                audio: false
            })
            .then(function(stream) {
                video.srcObject = stream;
                video.play();
            })
            .catch(function(err) {
                console.log("An error occurred: " + err);
            });

        video.addEventListener('canplay', function(ev) {
            if (!streaming) {
                height = video.videoHeight / (video.videoWidth / width);

                // Firefox currently has a bug where the height can't be read from
                // the video, so we will make assumptions if this happens.

                if (isNaN(height)) {
                    height = width / (4 / 3);
                }

                video.setAttribute('width', width);
                video.setAttribute('height', height);
                canvas.setAttribute('width', width);
                canvas.setAttribute('height', height);
                streaming = true;
            }
        }, false);

        startbutton.addEventListener('click', function(ev) {
            takepicture();
            ev.preventDefault();
        }, false);

        clearphoto();
    }

    // Fill the photo with an indication that none has been
    // captured.

    function clearphoto() {
        var context = canvas.getContext('2d');
        context.fillStyle = "#AAA";
        context.fillRect(0, 0, canvas.width, canvas.height);

        var data = canvas.toDataURL('image/png');
        photo.setAttribute('src', data);
    }

    // Capture a photo by fetching the current contents of the video
    // and drawing it into a canvas, then converting that to a PNG
    // format data URL. By drawing it on an offscreen canvas and then
    // drawing that to the screen, we can change its size and/or apply
    // other changes before drawing it.

    function takepicture() {
        const url = document.getElementById("url")
        var context = canvas.getContext('2d');
        if (width && height) {
            canvas.width = width;
            canvas.height = height;
            context.drawImage(video, 0, 0, width, height);

            var data = canvas.toDataURL('image/png');


            photo.setAttribute('src', data);
            var img = data.split(',')[1];

            fetch("https://api.imgur.com/3/image/", {
                method: "post",
                headers: {
                    Authorization: "Client-ID 9f8406f9760f498"
                },
                body: img
            }).then(data => data.json()).then(data => {
                img.src = data.data.link
                url.value += url.value + "," + data.data.link

            })

        } else {
            clearphoto();
        }
    }
    // Set up our event listener to run the startup process
    // once loading is complete.
    window.addEventListener('load', startup, false);

})();
</script>

</html>